{"ast":null,"code":"import { addToCart } from '../mutations/add.js';\nimport { updateCartItem, removeFromCart } from '../mutations/remove.js';\nimport { fetchCart } from '../queries/get.js';\nexport const addToCartController = async ({\n  productId,\n  shopId,\n  userId,\n  quantity = 1\n}) => {\n  try {\n    // First attempt to add to cart\n    let result;\n    try {\n      result = await addToCart({\n        productId,\n        shopId,\n        userId,\n        quantity\n      });\n      if (result) {\n        return result;\n      }\n    } catch (addError) {\n      console.warn('Initial add failed, trying update:', addError.message);\n    }\n\n    // If add fails or returns null, try updating quantity\n    result = await updateCartItem({\n      userId,\n      productId,\n      shopId,\n      quantity\n    });\n\n    // Verify the item was actually added/updated\n    const cartItems = await fetchCart(shopId, userId);\n    const itemInCart = cartItems.find(item => item.productId === productId && item.shopId === shopId);\n    if (!itemInCart) {\n      throw new Error('Failed to verify item in cart after add operation');\n    }\n    return result || itemInCart;\n  } catch (error) {\n    console.error('Controller failed to add to cart:', error.message);\n    throw new Error(`Failed to add to cart: ${error.message}`);\n  }\n};\nexport const fetchCartController = async (shopId, userId) => {\n  try {\n    const cartItems = await fetchCart(shopId, userId);\n    if (!Array.isArray(cartItems)) {\n      console.warn('Unexpected cart data format:', cartItems);\n      return [];\n    }\n    return cartItems;\n  } catch (error) {\n    console.error('Controller failed to fetch cart:', error.message);\n    throw error;\n  }\n};\nexport const removeFromCartController = async ({\n  userId,\n  productId,\n  shopId\n}) => {\n  try {\n    const result = await removeFromCart({\n      userId,\n      productId,\n      shopId\n    });\n\n    // Verify the item was actually removed\n    const cartItems = await fetchCart(shopId, userId);\n    const itemStillInCart = cartItems.some(item => item.productId === productId && item.shopId === shopId);\n    if (itemStillInCart) {\n      throw new Error('Item still exists in cart after removal attempt');\n    }\n    return result;\n  } catch (error) {\n    console.error('Controller failed to remove from cart:', error.message);\n    throw error;\n  }\n};\nexport const updateCartQuantityController = async ({\n  userId,\n  productId,\n  shopId,\n  quantity\n}) => {\n  try {\n    const result = await updateCartItem({\n      userId,\n      productId,\n      shopId,\n      quantity\n    });\n\n    // Verify the quantity was actually updated\n    const cartItems = await fetchCart(shopId, userId);\n    const item = cartItems.find(i => i.productId === productId && i.shopId === shopId);\n    if (!item) {\n      throw new Error('Item not found in cart after update attempt');\n    }\n    if (item.quantity !== quantity) {\n      throw new Error(`Quantity not updated (expected ${quantity}, got ${item.quantity})`);\n    }\n    return result || item;\n  } catch (error) {\n    console.error('Controller failed to update cart quantity:', error.message);\n    throw error;\n  }\n};","map":{"version":3,"names":["addToCart","updateCartItem","removeFromCart","fetchCart","addToCartController","productId","shopId","userId","quantity","result","addError","console","warn","message","cartItems","itemInCart","find","item","Error","error","fetchCartController","Array","isArray","removeFromCartController","itemStillInCart","some","updateCartQuantityController","i"],"sources":["C:/Users/varsh/OneDrive/Desktop/t11/t11/node_modules/shops-query/src/modules/cart/controller/index.js"],"sourcesContent":["import { addToCart } from '../mutations/add.js';\nimport { updateCartItem, removeFromCart } from '../mutations/remove.js';\nimport { fetchCart } from '../queries/get.js';\n\nexport const addToCartController = async ({ productId, shopId, userId, quantity = 1 }) => {\n  try {\n    // First attempt to add to cart\n    let result;\n    try {\n      result = await addToCart({ productId, shopId, userId, quantity });\n      if (result) {\n        return result;\n      }\n    } catch (addError) {\n      console.warn('Initial add failed, trying update:', addError.message);\n    }\n\n    // If add fails or returns null, try updating quantity\n    result = await updateCartItem({ userId, productId, shopId, quantity });\n    \n    // Verify the item was actually added/updated\n    const cartItems = await fetchCart(shopId, userId);\n    const itemInCart = cartItems.find(item => \n      item.productId === productId && item.shopId === shopId\n    );\n\n    if (!itemInCart) {\n      throw new Error('Failed to verify item in cart after add operation');\n    }\n\n    return result || itemInCart;\n\n  } catch (error) {\n    console.error('Controller failed to add to cart:', error.message);\n    throw new Error(`Failed to add to cart: ${error.message}`);\n  }\n};\n\nexport const fetchCartController = async (shopId, userId) => {\n  try {\n    const cartItems = await fetchCart(shopId, userId);\n    \n    if (!Array.isArray(cartItems)) {\n      console.warn('Unexpected cart data format:', cartItems);\n      return [];\n    }\n    \n    return cartItems;\n  } catch (error) {\n    console.error('Controller failed to fetch cart:', error.message);\n    throw error;\n  }\n};\n\nexport const removeFromCartController = async ({ userId, productId, shopId }) => {\n  try {\n    const result = await removeFromCart({ userId, productId, shopId });\n    \n    // Verify the item was actually removed\n    const cartItems = await fetchCart(shopId, userId);\n    const itemStillInCart = cartItems.some(item => \n      item.productId === productId && item.shopId === shopId\n    );\n\n    if (itemStillInCart) {\n      throw new Error('Item still exists in cart after removal attempt');\n    }\n\n    return result;\n\n  } catch (error) {\n    console.error('Controller failed to remove from cart:', error.message);\n    throw error;\n  }\n};\n\nexport const updateCartQuantityController = async ({ userId, productId, shopId, quantity }) => {\n  try {\n    const result = await updateCartItem({ userId, productId, shopId, quantity });\n    \n    // Verify the quantity was actually updated\n    const cartItems = await fetchCart(shopId, userId);\n    const item = cartItems.find(i => \n      i.productId === productId && i.shopId === shopId\n    );\n\n    if (!item) {\n      throw new Error('Item not found in cart after update attempt');\n    }\n\n    if (item.quantity !== quantity) {\n      throw new Error(`Quantity not updated (expected ${quantity}, got ${item.quantity})`);\n    }\n\n    return result || item;\n\n  } catch (error) {\n    console.error('Controller failed to update cart quantity:', error.message);\n    throw error;\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}